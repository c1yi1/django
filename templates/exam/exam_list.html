{% extends 'base.html' %}

{% block title %}考试管理 - 智能学习系统{% endblock %}

{% block header_nav %}
<nav class="header-nav">
    <a href="{% url 'exam:admin_dashboard' %}" class="nav-link">
        <i class="ri-dashboard-3-line"></i> 控制台
    </a>
    <a href="{% url 'exam:exam_list' %}" class="nav-link active">
        <i class="ri-calendar-check-line"></i> 考试管理
    </a>
    <a href="{% url 'exam:question_list' %}" class="nav-link">
        <i class="ri-file-list-3-line"></i> 题库管理
    </a>
    <a href="{% url 'exam:exam_statistics_entry' %}" class="nav-link">
        <i class="ri-pie-chart-line"></i> 成绩统计
    </a>
</nav>
{% endblock %}

{% block extra_css %}
<style>
    .table-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        overflow: hidden;
    }
    
    .data-table th {
        background: rgba(255, 255, 255, 0.02);
        padding: 16px;
    }
    
    .data-table td {
        padding: 14px 16px;
    }
    
    .exam-title {
        font-weight: 500;
        color: var(--text-primary);
    }
    
    .tag-draft { background: rgba(148, 163, 184, 0.15); color: #94a3b8; }
    .tag-published { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
    .tag-ongoing { background: rgba(56, 239, 213, 0.15); color: var(--accent-primary); }
    .tag-finished { background: rgba(239, 68, 68, 0.15); color: #f87171; }
    
    .action-btns {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
    }
    
    .action-btns .btn {
        padding: 6px 12px;
        font-size: 12px;
    }
    
    .time-cell {
        font-size: 13px;
        color: var(--text-muted);
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i class="ri-calendar-check-line"></i>
        考试管理
    </h1>
    <p class="page-subtitle">创建和管理考试，配置试卷与考试规则</p>
    <div class="page-actions">
        <a href="{% url 'exam:exam_create' %}" class="btn btn-primary">
            <i class="ri-add-line"></i> 创建考试
        </a>
        <a href="{% url 'exam:exam_statistics_entry' %}" class="btn btn-secondary">
            <i class="ri-pie-chart-line"></i> 成绩统计
        </a>
    </div>
</div>

<!-- 筛选栏 -->
<div class="filter-bar">
    <form method="get" style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center; width: 100%;">
        <div class="search-input-wrap" style="flex: 1; min-width: 200px;">
            <i class="ri-search-line"></i>
            <input type="text" name="search" value="{{ search_query }}" placeholder="搜索考试名称...">
        </div>
        <div class="filter-item">
            <label>状态</label>
            <select name="status" class="form-control" style="width: auto;">
                <option value="">全部</option>
                <option value="draft" {% if selected_status == 'draft' %}selected{% endif %}>草稿</option>
                <option value="published" {% if selected_status == 'published' %}selected{% endif %}>已发布</option>
                <option value="ongoing" {% if selected_status == 'ongoing' %}selected{% endif %}>进行中</option>
                <option value="finished" {% if selected_status == 'finished' %}selected{% endif %}>已结束</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary btn-sm">
            <i class="ri-filter-line"></i> 筛选
        </button>
        <a href="{% url 'exam:exam_list' %}" class="btn btn-secondary btn-sm">
            <i class="ri-refresh-line"></i> 重置
        </a>
    </form>
</div>

<!-- 数据表格 -->
<div class="table-card">
    <table class="data-table">
        <thead>
            <tr>
                <th style="width: 60px;">ID</th>
                <th>考试名称</th>
                <th style="width: 140px;">开始时间</th>
                <th style="width: 140px;">结束时间</th>
                <th style="width: 80px;">时长</th>
                <th style="width: 70px;">总分</th>
                <th style="width: 90px;">状态</th>
                <th style="width: 200px;">操作</th>
            </tr>
        </thead>
        <tbody>
            {% for exam in page_obj %}
            <tr>
                <td>{{ exam.id }}</td>
                <td>
                    <span class="exam-title">{{ exam.title }}</span>
                </td>
                <td class="time-cell">{{ exam.start_time|date:"m-d H:i" }}</td>
                <td class="time-cell">{{ exam.end_time|date:"m-d H:i" }}</td>
                <td>{{ exam.duration }}分钟</td>
                <td>{{ exam.total_score }}分</td>
                <td>
                    <span class="tag tag-{{ exam.time_status }}">{{ exam.get_time_status_display }}</span>
                </td>
                <td>
                    <div class="action-btns">
                        <a href="{% url 'exam:exam_detail' exam.id %}" class="btn btn-secondary btn-sm">
                            <i class="ri-eye-line"></i>
                        </a>
                        <a href="{% url 'exam:exam_statistics' exam.id %}" class="btn btn-primary btn-sm">
                            <i class="ri-bar-chart-line"></i>
                        </a>
                        <a href="{% url 'exam:exam_edit' exam.id %}" class="btn btn-success btn-sm">
                            <i class="ri-edit-line"></i>
                        </a>
                        <form method="post" action="{% url 'exam:exam_delete' exam.id %}" style="display:inline;" onsubmit="return confirm('确定要删除考试《{{ exam.title }}》吗？');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-sm">
                                <i class="ri-delete-bin-line"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8">
                    <div class="empty-state">
                        <i class="ri-calendar-line"></i>
                        <p>暂无考试数据</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- 分页 -->
{% if page_obj.has_other_pages %}
<div class="pagination">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_status %}&status={{ selected_status }}{% endif %}">
        <i class="ri-arrow-left-s-line"></i> 上一页
    </a>
    {% endif %}
    
    <span class="current">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
    
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_status %}&status={{ selected_status }}{% endif %}">
        下一页 <i class="ri-arrow-right-s-line"></i>
    </a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
